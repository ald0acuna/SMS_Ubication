<!DOCTYPE html>
<html lang="en">
<head>

    <script src='/socket.io/socket.io.js'></script> 
  
    <script>socket = io.connect('http://54.196.238.128:10000/');</script>

     
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <link rel="stylesheet" href="../css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/3.4.0/es5-shim.min.js"></script>
    <script src="https://www.promisejs.org/polyfills/promise-6.1.0.js"></script>
    
    
    <title>Coordenadas geograficas</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
   <link rel="stylesheet" type="text/css" href="../archivos/jquery.datetimepicker.css">
   <script src="../archivos/jquery.js"></script>
   <script src="../archivos/build/jquery.datetimepicker.full.min.js"></script>
   
    
</head>
<body onload="readFile();">
    <div class="container-css">
        <section class="header">
            <h1>Coordenadas geograficas</h1>
        </section>
        <section class="content">
            <div class="user-container">
                <form id="form" class="calendar">
                    
                    <input type="text" id="date_timepicker_start"  name="start" placeholder="Fecha de inicio" autocomplete="off">
                    <h6>Hora inicial:</h6>
                    <select name="hora" id="campoHora">
                        <option value="0">00</option>
                        <option value="1">01</option>
                        <option value="2">02</option>
                        <option value="3">03</option>
                        <option value="4">04</option>
                        <option value="5">05</option>
                        <option value="6">06</option>
                        <option value="7">07</option>
                        <option value="8">08</option>
                        <option value="9">09</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                    </select>
                
                
                
                    <select name="minuto" id="campoMinuto" >
                        <option value="0">00</option>
                        <option value="1">01</option>
                        <option value="2">02</option>
                        <option value="3">03</option>
                        <option value="4">04</option>
                        <option value="5">05</option>
                        <option value="6">06</option>
                        <option value="7">07</option>
                        <option value="8">08</option>
                        <option value="9">09</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>
                        <option value="32">32</option>
                        <option value="33">33</option>
                        <option value="34">34</option>
                        <option value="35">35</option>
                        <option value="36">36</option>
                        <option value="37">37</option>
                        <option value="38">38</option>
                        <option value="39">39</option>
                        <option value="40">40</option>
                        <option value="41">41</option>
                        <option value="42">42</option>
                        <option value="43">43</option>
                        <option value="44">44</option>
                        <option value="45">45</option>
                        <option value="46">46</option>
                        <option value="47">47</option>
                        <option value="48">48</option>
                        <option value="49">49</option>
                        <option value="50">50</option>
                        <option value="51">51</option>
                        <option value="52">52</option>
                        <option value="53">53</option>
                        <option value="54">54</option>
                        <option value="55">55</option>
                        <option value="56">56</option>
                        <option value="57">57</option>
                        <option value="58">58</option>
                        <option value="59">59</option>
                
                        
                    </select>
                    
                    <input type="text" id="date_timepicker_end" name= "end" placeholder="Fecha final" autocomplete="off">
                    <h6>Hora final:</h6>
                    <select name="horaTF" id="campoHoraTF">
                        <option value="0">00</option>
                        <option value="1">01</option>
                        <option value="2">02</option>
                        <option value="3">03</option>
                        <option value="4">04</option>
                        <option value="5">05</option>
                        <option value="6">06</option>
                        <option value="7">07</option>
                        <option value="8">08</option>
                        <option value="9">09</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                    </select>
                
                    
                    <select name="minutoTF" id="campoMinutoTF" >
                        <option value="0">00</option>
                        <option value="1">01</option>
                        <option value="2">02</option>
                        <option value="3">03</option>
                        <option value="4">04</option>
                        <option value="5">05</option>
                        <option value="6">06</option>
                        <option value="7">07</option>
                        <option value="8">08</option>
                        <option value="9">09</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                        <option value="13">13</option>
                        <option value="14">14</option>
                        <option value="15">15</option>
                        <option value="16">16</option>
                        <option value="17">17</option>
                        <option value="18">18</option>
                        <option value="19">19</option>
                        <option value="20">20</option>
                        <option value="21">21</option>
                        <option value="22">22</option>
                        <option value="23">23</option>
                        <option value="24">24</option>
                        <option value="25">25</option>
                        <option value="26">26</option>
                        <option value="27">27</option>
                        <option value="28">28</option>
                        <option value="29">29</option>
                        <option value="30">30</option>
                        <option value="31">31</option>
                        <option value="32">32</option>
                        <option value="33">33</option>
                        <option value="34">34</option>
                        <option value="35">35</option>
                        <option value="36">36</option>
                        <option value="37">37</option>
                        <option value="38">38</option>
                        <option value="39">39</option>
                        <option value="40">40</option>
                        <option value="41">41</option>
                        <option value="42">42</option>
                        <option value="43">43</option>
                        <option value="44">44</option>
                        <option value="45">45</option>
                        <option value="46">46</option>
                        <option value="47">47</option>
                        <option value="48">48</option>
                        <option value="49">49</option>
                        <option value="50">50</option>
                        <option value="51">51</option>
                        <option value="52">52</option>
                        <option value="53">53</option>
                        <option value="54">54</option>
                        <option value="55">55</option>
                        <option value="56">56</option>
                        <option value="57">57</option>
                        <option value="58">58</option>
                        <option value="59">59</option>
                
                        
                    </select>

                    <span id="span" value="1"></span>
        
                    <script>
            
                        //Para las horas
                        $("#campoHora").change(function() {

                            var j=0;
                            while(j<59){
                                $("#campoHoraTF").find("option[value='"+j+"']").prop("disabled",false);
                                j=j+1
                            }
                
                            if($("#date_timepicker_start").val()==$("#date_timepicker_end").val()){
                                var i = 0;
                                while(i<$("#campoHora").val()){
                                    $("#campoHoraTF").find("option[value='"+i+"']").prop("disabled",true);
                                    i=i+1;
                                }
                                document.getElementById("campoHoraTF").value = Number($('#campoHora').val()) + 1;
                            }

                        });

                        $("#date_timepicker_start").change(function() {
                            var j=0;
                            while(j<59){
                                $("#campoHoraTF").find("option[value='"+j+"']").prop("disabled",false);
                                j=j+1
                            }

                            var j=0;
                            while(j<59){
                                $("#campoHoraTF").find("option[value='"+j+"']").prop("disabled",false);
                                j=j+1
                            }
                
                            if($("#date_timepicker_start").val()==$("#date_timepicker_end").val()){
                                var i = 0;
                                while(i<$("#campoHora").val()){
                                    $("#campoHoraTF").find("option[value='"+i+"']").prop("disabled",true);
                                    i=i+1;
                                }
                                document.getElementById("campoHoraTF").value = $("#campoHora").val();

                                if($("#campoHora").val()==$("#campoHoraTF").val()){

                                    var k = 0;
                                    while(k<=$("#campoMinuto").val()){
                                        $("#campoMinutoTF").find("option[value='"+k+"']").prop("disabled",true);
                                        k=k+1;
                                    }
                                    document.getElementById("campoMinutoTF").value = Number($('#campoMinuto').val()) + 1; 
                                }
                         

                            } else {
                                var j=0;
                                while(j<59){
                                    $("#campoMinutoTF").find("option[value='"+j+"']").prop("disabled",false);
                                    j=j+1
                                }
                            }
                        });  

                        $("#date_timepicker_end").change(function() {
                            var j=0;
                            while(j<59){
                                $("#campoHoraTF").find("option[value='"+j+"']").prop("disabled",false);
                                j=j+1
                            }

                            var j=0;
                            while(j<59){
                                $("#campoHoraTF").find("option[value='"+j+"']").prop("disabled",false);
                                j=j+1
                            }
                            
                            if($("#date_timepicker_start").val()==$("#date_timepicker_end").val()){
                                var i = 0;
                                while(i<$("#campoHora").val()){
                                    $("#campoHoraTF").find("option[value='"+i+"']").prop("disabled",true);
                                    i=i+1;
                                }
                                document.getElementById("campoHoraTF").value = $("#campoHora").val();

                                if($("#campoHora").val()==$("#campoHoraTF").val()){

                                    var k = 0;
                                    while(k<=$("#campoMinuto").val()){
                                        $("#campoMinutoTF").find("option[value='"+k+"']").prop("disabled",true);
                                        k=k+1;
                                    }
                                    document.getElementById("campoMinutoTF").value = Number($('#campoMinuto').val()) + 1; 
                                }
                            } else {
                                var j=0;
                                while(j<59){
                                    $("#campoMinutoTF").find("option[value='"+j+"']").prop("disabled",false);
                                    j=j+1
                                }
                            }
                        }); 

                        //Para los minutos
                        $("#campoMinuto").change(function() {

                            var j=0;
                                while(j<59){
                                    $("#campoMinutoTF").find("option[value='"+j+"']").prop("disabled",false);
                                    j=j+1
                                }
                            
                            if($("#campoHora").val()==$("#campoHoraTF").val()){
                                var i = 0;
                                while(i<=$("#campoMinuto").val()){
                                    $("#campoMinutoTF").find("option[value='"+i+"']").prop("disabled",true);
                                    i=i+1;
                                }

                                document.getElementById("campoMinutoTF").value = Number($('#campoMinuto').val()) + 1;
                            }

                        });

                        $("#campoHora").change(function() {
                                var j=0;
                                while(j<59){
                                    $("#campoMinutoTF").find("option[value='"+j+"']").prop("disabled",false);
                                    j=j+1
                                }
                        });  

                        $("#campoHoraTF").change(function() {
                                var j=0;
                                while(j<59){
                                    $("#campoMinutoTF").find("option[value='"+j+"']").prop("disabled",false);
                                    j=j+1
                                }

                        
                            
                            if($("#campoHora").val()==$("#campoHoraTF").val()){
                                var i = 0;
                                while(i<=$("#campoMinuto").val()){
                                    $("#campoMinutoTF").find("option[value='"+i+"']").prop("disabled",true);
                                    i=i+1;
                                }
                            }
                        }); 
                        
                    </script>

                    <script>
                        //$(function () {
                            $("#date_timepicker_start").datetimepicker({
                                format: 'Y/m/d',
                                onShow: function (ct) {
                                    this.setOptions({
                                        maxDate: jQuery('#date_timepicker_end').val() ? jQuery('#date_timepicker_end').val() : false
                                    })
                                },
                                timepicker: false
                            });
                            $("#date_timepicker_end").datetimepicker({
                                format: 'Y/m/d',
                                onShow: function (ct) {
                                    this.setOptions({
                                        minDate: jQuery('#date_timepicker_start').val() ? jQuery('#date_timepicker_start').val() : false
                                    })
                                },
                                timepicker: false
                            });
                        
                    </script>

               
                    <select name="vehiculo" id="carro">
                        <option value="1">Vehículo 1</option>
                        <option value="2">Vehículo 2</option>
                    </select>
                    <button type="submit" class="historicos" >Historicos</button>
                    
                </form>

                <script>
                    const form = document.getElementById('form')

                    form.addEventListener('submit', (e) => {

                        e.preventDefault();

                        puntos.clearLayers();
                        document.getElementById("mymap").style.display = "block";

                        document.getElementById("mymapTR").style.display = "none";

                        inicio = e.target.elements.date_timepicker_start.value;
                        horaInicio = e.target.elements.campoHora.value;
                        minInicio = e.target.elements.campoMinuto.value;
                        fin = e.target.elements.date_timepicker_end.value;
                        horaFin = e.target.elements.campoHoraTF.value;
                        minFin = e.target.elements.campoMinutoTF.value;
                        vehiculo= e.target.elements.carro.value;

                        var valoresEntrada = [];
                        valoresEntrada.push(inicio);
                        valoresEntrada.push(horaInicio);
                        valoresEntrada.push(minInicio);
                        valoresEntrada.push(fin);
                        valoresEntrada.push(horaFin);
                        valoresEntrada.push(minFin);
                        valoresEntrada.push(vehiculo);
                        
                        socket.emit("valoresEntrada", valoresEntrada);

    
                        socket.on('historia', function (output) {
    
                            hist =[];
                            var coor =[];
                            
                            for (var i of output) {
                                coor =[i.latitud,i.longitud]
                                hist.push(coor)
                                markerCircle = L.circleMarker([i.latitud,i.longitud],{radius:2, color:'black'})
                                markerCircle.bindTooltip("</h4>tiempo: "+ i.tiempo)
                                puntos.addLayer(markerCircle)
                                    
                            }
                            
                            puntos.addTo(myMap)
                                
                            if (output.length != 0){    
                                polyline.setLatLngs(hist);
                                myMap.setView(polyline.getCenter())
                            } else {
                                alert("No hay recorridos dentro de las fechas ingresadas")
                                polyline.setLatLngs([]);
                            }
                        });

                        

                    });
                </script>

                <div class="tiemporeal">
                    <div class="ubication">
                        <h3>Coordenadas:</h3>
                        <div class="form-container">
                            <form action="/coordenadas/">
                                <label for="Length">Longitud:</label>
                                <div id="caja-longitude"></div>
                                <label for="Latitude">Latitud:</label>
                                <div id="caja-latitude"></div>
                                <label for="Stamptime">Stamptime:</label>
                                <div id="caja-stamptime"></div>
                            </form>
                        </div>
                    </div>
                    <button type="submit" onclick="tiempoReal()">Tiempo real</button>
                </div>

            </div>

            
        </section>
        <div id="mymap" class="mapa" style="height: 595px;"></div>
        <div id="mymapTR" class="mapaTR" style="height: 595px;"></div>
        <!-- <footer class="footer">
            <p>2020 - Proyecto realizado para la Universidad del norte</p>
        </footer> -->

        <!--Scripts-->
        <script src="../js/jquery-3.5.1.min.js"></script>
        <!-- <script src="../js/bootstrap.min.js"></script> -->
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
       
        
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
        <script src='../js/front-end.js'></script>
        
        
    </div>
</body>
</html>
